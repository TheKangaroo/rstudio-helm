apiVersion: v1
kind: Pod
metadata:
  name: {{ include "rstudio-workbench.fullname" . }}-test
  annotations:
   "helm.sh/hook": test
spec:
  {{- $serviceAccountName := .Values.rbac.serviceAccount.name | default (include "rstudio-workbench.fullname" .)}}
  {{- if or .Values.rbac.create (.Values.rbac.serviceAccount.name) }}
  serviceAccountName: {{ $serviceAccountName }}
  {{- end }}
  {{- with .Values.image.imagePullSecrets }}
  imagePullSecrets:
    {{- toYaml . | nindent 4 }}
  {{- end }}
  shareProcessNamespace: {{ .Values.shareProcessNamespace }}
  restartPolicy: Never
  {{- $topLevelParams := dict "diagnostics" (dict "enabled" true) "userCreate" true }}
  {{- $disabledObject := dict "enabled" false }}
  {{- $readinessProbe := dict "readinessProbe" $disabledObject }}
  {{- $livenessProbe := dict "livenessProbe" $disabledObject }}
  {{- $startupProbe := dict "startupProbe" $disabledObject }}
  {{- $prometheusExporter := dict "prometheusExporter" $disabledObject }}
  {{- $overrideDict := . | deepCopy }}
  {{- $_ := mergeOverwrite $overrideDict.Values $prometheusExporter $startupProbe $livenessProbe $readinessProbe $topLevelParams }}
{{ include "rstudio-workbench.containers" $overrideDict | indent 2 }}
